pool:
  name: Azure Pipelines

steps:
- script: |
   python3 -m venv .venv
   source .venv/bin/activate
   python3 -m pip install --upgrade pip
   pip install -r requirements.in

  workingDirectory: project
  displayName: 'Install requirements'

- script: |
   source .venv/bin/activate
   python3 -m pip install pytest
   pytest

  workingDirectory: project
  displayName: 'Run pytest'

- task: DockerInstaller@0
  displayName: 'Install Docker 17.09.0-ce'

- task: Docker@2
  displayName: buildAndPush
  inputs:
    containerRegistry: 'docker hub connection'
    repository: 'paulbhs/website-portfolio'
    Dockerfile: project/Dockerfile
    buildContext: project